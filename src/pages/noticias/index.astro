---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import AdSlot from "../../components/ads/AdSlot.astro";

const posts = await getCollection("noticias");
const PAGE_SIZE = 8;
const totalPages = Math.ceil(posts.length / PAGE_SIZE);
const page = 1;
const start = (page - 1) * PAGE_SIZE;
const pagePosts = posts.slice(start, start + PAGE_SIZE);
const pageHref = (n) => (n === 1 ? "/noticias" : `/noticias/${n}`);
---

<BaseLayout title="Noticias - RunaMedios">
  <section class="contenedor">
    <aside class="ad-left">
      <div class="ad-box ad-160x300">
        <script type="text/javascript">
          atOptions = {
            key: "08b2c4cc732051094c6966a81721d1a3",
            format: "iframe",
            height: 300,
            width: 160,
            params: {},
          };
        </script>
        <script
          type="text/javascript"
          src="//www.highperformanceformat.com/08b2c4cc732051094c6966a81721d1a3/invoke.js"
        ></script>
      </div>
    </aside>

    <div class="main">
      <h1>Noticias</h1>

      <div class="lista">
        {
          pagePosts.map((post) => (
            <a href={`/noticias/${post.slug}`} class="card">
              {post.data.img && (
                <img src={post.data.img} alt={post.data.title} />
              )}
              <h2>{post.data.title}</h2>
              <p>{post.data.date}</p>
            </a>
          ))
        }
      </div>

      <nav class="pagination" aria-label="Paginación de noticias">
        <a
          class="page-btn prev"
          href={pageHref(Math.max(1, page - 1))}
          aria-disabled={page === 1}>Anterior</a
        >
        <div class="pages">
          {
            Array.from({ length: totalPages }, (_, i) => i + 1).map((n) => (
              <a
                href={pageHref(n)}
                class={`page-num ${n === page ? "active" : ""}`}
                aria-current={n === page ? "page" : undefined}
              >
                {n}
              </a>
            ))
          }
        </div>
        <a
          class="page-btn next"
          href={pageHref(Math.min(totalPages, page + 1))}
          aria-disabled={page === totalPages}>Siguiente</a
        >
      </nav>

      <!-- Banner 728x90 existente -->
      <script type="text/javascript">
        atOptions = {
          key: "9eef77ca2aa6c15adf4cb0f66c8462ca",
          format: "iframe",
          height: 90,
          width: 728,
          params: {},
        };
      </script>
      <script
        type="text/javascript"
        src="//www.highperformanceformat.com/9eef77ca2aa6c15adf4cb0f66c8462ca/invoke.js"
      ></script>
    </div>

    <aside class="ad-right">
      <div class="ad-box ad-160x600">
        <!-- Publicidad 160x600 (derecha A) -->
        <script type="text/javascript">
          atOptions = {
            key: "1a886af9fafacd539ac87d3c3fad0fb8",
            format: "iframe",
            height: 600,
            width: 160,
            params: {},
          };
        </script>
        <script
          type="text/javascript"
          src="//www.highperformanceformat.com/1a886af9fafacd539ac87d3c3fad0fb8/invoke.js"
        ></script>
      </div>
    </aside>
  </section>
</BaseLayout>

<style>
  .contenedor {
    max-width: 1200px;
    margin: auto;
    padding: 40px 20px;
    margin: 20px;
    display: grid;
    grid-template-columns: 180px 1fr 180px;
    gap: 24px;
    align-items: start;
  }

  .main {
    min-width: 0;
  }

  .ad-left,
  .ad-right {
    position: sticky;
    top: 20px;
    align-self: start;
  }

  .ad-box {
    width: 160px;
    background: #0c0f12;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 1px dashed #4cf2d6;
  }
  .ad-160x300 {
    height: 300px;
  }
  .ad-160x600 {
    height: 600px;
  }
  .ad-right .ad-box + .ad-box {
    margin-top: 20px;
  }
  h1 {
    margin-bottom: 20px;
    font-size: 32px;
    color: #4cf2d6;
  }
  .lista {
    display: grid;
    gap: 24px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }
  .card {
    background: #0c0f12;
    border-radius: 8px;
    padding: 12px;
    text-decoration: none;
    color: #ccd0d4;
    transition: 0.2s;
  }
  .card:hover {
    background: #162029;
  }
  .card img {
    width: 100%;
    border-radius: 6px;
    height: 160px;
    object-fit: cover;
  }
  .card h2 {
    font-size: 18px;
    margin-top: 10px;
  }
  .card p {
    font-size: 13px;
    opacity: 0.6;
  }

  /* Paginación */
  .pagination {
    margin-top: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .page-btn, .page-num {
    background: #0c0f12;
    border: 1px solid #162029;
    color: #ccd0d4;
    border-radius: 6px;
    padding: 8px 12px;
    text-decoration: none;
    transition: background .2s, border-color .2s, color .2s;
    font-size: 14px;
    line-height: 1;
  }
  .page-btn:hover, .page-num:hover { background: #162029; }
  .page-num.active {
    background: #01402e;
    border-color: #01402e;
    color: #ffffff;
    font-weight: 600;
  }
  .pages { display: flex; gap: 8px; flex-wrap: wrap; }
  .page-btn[aria-disabled="true"] {
    opacity: 0.4;
    pointer-events: none;
    cursor: default;
  }

  /* Responsive: ocultar sidebars en pantallas pequeñas */
  @media (max-width: 1024px) {
    .contenedor {
      grid-template-columns: 1fr;
    }
    .ad-left,
    .ad-right {
      display: none;
    }
  }
</style>
